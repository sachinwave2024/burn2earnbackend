{% extends 'default_theme/base/__base.html' %}
{% load static %} 

{% load form_custom %}

{% block Style_sheets %}


{% endblock Style_sheets %}

{% load django_tables2 crispy_forms_tags %}

 {% load render_table from django_tables2 %}

 {% block Content_Area %}
   
    <section class="content">
     
      <div class="loader" id="loader_spin_id" style="display: none;">
        <div class="spinner"><div class="double-bounce1"></div><div class="double-bounce2"></div></div>
        <div class="test" style="color: white; text-align: center;"><p> File download in process...<br> Please donâ€™t refresh the page.</p></div>
        </div>
     
   	 <div class="box box-default">
        <div class="box-header with-border">
          <h3 class="box-title">{{ Title }}</h3>

          <div class="box-tools pull-right">
           
          </div>
        </div>
     {% if messages %}
     {% for message in messages %}
     <div class="alert {{ message.tags }} alert-dismissible" role="alert">
      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span> 
      </button>
      {{ message }}
    </div>
    {% endfor %}
    {% endif %}
    <div class="row ">    
      <div class="col-md-6 col-xs-12 pull-right"> 
           <div class="panel-group accordion" id="accordion1">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="panel-title">
                        <a id="accordion-search" class="accordion-toggle collapsed" data-toggle="collapse" data-parent="#accordion1" href="#collapse_1" aria-expanded="false">
                        <i class="fa fa-search font-dark"></i>
                  <span class="caption-subject font-dark bold uppercase">Advanced Search</span>
                  <span style="float:right"><i class="fa fa-angle-down" aria-hidden="true"></i></span>
                        </a>
                        
                    </div>
                    
                </div>
                <div id="collapse_1" class="panel-collapse collapse" aria-expanded="false" style="height: 0px;">
                    <div class="panel-body">
                        <!-- {% crispy filter.form filter.form.helper %} -->
                      
                        

                        <form class="form-horizontal" id="Bill_Search_Form" method="get"> 
                          <div class="form">
                          <div id="div_id_email" class="control-group"> 
                            <label for="id_email" class="control-label ">
                          
                                        Email
                          </label> 
                          <div class="controls">
                            {% if request.GET.email != None %} 
                            <input type="text" name="email" class="textinput textInput" value=" {{request.GET.email}}" id="id_email"> 
                            {% else %}
                            <input type="text" name="email" class="textinput textInput" id="id_email"> 
                            {% endif%}
                          </div> 
                        </div> 
                        <div id="div_id_from_wallet" class="control-group">
                            <label for="id_from_wallet" class="control-label ">
                                        From Wallet
                                    </label>
                                      <div class="controls"> 
                                      {% if request.GET.from_wallet != None %}
                                        <input type="text" name="from_wallet" class="textinput textInput" value=" {{request.GET.from_wallet}}" id="id_from_wallet"> 
                                        {% else %}
                                        <input type="text" name="from_wallet" class="textinput textInput" id="id_from_wallet"> 
                                        {% endif %}
                                      </div> 
                                    </div>
                                   
                      
                        </div>
                        <div class="form-actions"> 
                          <input type="submit" name="submit" value="Search" class="btn btn-primary" id="submit-id-submit">
                            <input type="reset" name="reset-search" value="Reset Search" class="btn btn-inverse btn btn-default" id="reset-search">
                            </div> 
                          </form>
                      </div>
                                  
                        
                                                                                  
                    </div>
                </div>
            </div>
        </div>  
  
      </div>
    

    <style>
      .pagination{
        padding-left: 450px;
      }
      .form{
        display: flex;
      }
      .form .control-group{
     
        margin-right: 15px;
        margin-bottom: 15px;
      }
      #example1_info {
 padding: 25px 0;
}

.pagination {
 /* padding-left: 1015px; */
 float: right;
}
    </style>
   
     <div class="box">
            <div class="box-header">
              <h3 class="box-title"></h3>
              <div class="box-tools pull-right">                         
                        </div>
            </div>

             <div class="table-responsive">
          
            <div class="box-body">
               {% render_table table %} 
               
                <div class="dataTables_info" id="example1_info" role="status" aria-live="polite">
                  Showing {{table.get_start_index}} to {{table.get_end_index}} of {{user_count}} entries
                </div>
              
            </div>
            </div>
          
          </div>
        
      </div>

    </section>
   
   

 {% endblock Content_Area %}

 {% block Java_Scripts %}

 <script>
  $(document).ready(function(){
    
    $("#reset-productid-clear").click(function(){
      $("{{filter.form.helper.form_id}}").trigger('reset'); 
      
    });
    
  $("#reset-search").click(function(){
      
    window.location = "{% url Btn_url %}";
      
    });
      
  })  
  
  
  </script>

<script src="https://cdn.tutorialjinni.com/jquery-csv/1.0.11/jquery.csv.min.js"></script>

<script>
  function CSV_file_ajax() {
    $("#loader_spin_id").show();
     $.ajax({
         type: "POST",
         url: '/tradeadmin/download_csv_user_management_report/', 
         data: {
             start_date : $("#id_start_date").val(), 
             end_date : $("#id_end_date").val(), 
             csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val()
         },
         success:function(data)
         {
           if(data.start_date != "" && data.end_date != ""){
              if(data.start_date <= data.end_date){
                  if(data.data != ""){
                    
                      if (data.status == "true") {
                        
                        const str_date = data.start_date
                        const end_date = data.end_date

                        const csv = $.csv.fromObjects(data.data);
                        downloadBlobAsFile(csv, str_date + '_to_' + end_date + ' transaction.csv' );
                        $("#loader_spin_id").hide();
                      } else {
                        alert("No records found !!!!")
                        $("#loader_spin_id").hide();
                      }
                }else{
                  alert("No records found.")
                  $("#loader_spin_id").hide();
              }
            }else{
              alert("Invalid end date.")
              $("#loader_spin_id").hide();
            }
          }else{
            alert("Make sure select date.")
            $("#loader_spin_id").hide();
          }
         },
     });
     };

    const downloadBlobAsFile = function(csv, filename){
      var downloadLink = document.createElement("a");
      var blob = new Blob([csv], { type: 'text/csv' });
      var url = URL.createObjectURL(blob);
      downloadLink.href = url;
      downloadLink.download = filename;
      document.body.appendChild(downloadLink);
      downloadLink.click();
      document.body.removeChild(downloadLink);
    }

 </script>




<style>
  /*-- -- -- -- -|| Loader Styles Start Here ||- -- -- -- --*/
  .loader {
      background: rgba(0, 4, 10, 0.9) none repeat scroll 0 0;
      bottom: 0;
      height: 100%;
      left: 0;
      position: fixed;
      right: 0;
      top: 0;
      width: 100%;
      z-index: 9999;
  }
  .spinner {
      height: 40px;
      margin: auto;
      position: absolute;
      width: 40px;
      left: 0;
      right: 0;
      top: 0;
      bottom: 0;
  }
  .double-bounce1, .double-bounce2 {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background-color: #fff;
      opacity: 0.6;
      position: absolute;
      top: 0;
      left: 0;
      -webkit-animation: sk-bounce 2.0s infinite ease-in-out;
      animation: sk-bounce 2.0s infinite ease-in-out;
  }
  .double-bounce2 {
      -webkit-animation-delay: -1.0s;
      animation-delay: -1.0s;
  }
  /*-- -- -- -- -|| Loader Styles End Here ||- -- -- -- --*/
  
  </style>
  


 {% endblock %}


