{% extends 'default_theme/base/__base.html' %}
{% load static %} 

{% load form_custom %}


{% block Style_sheets %}
{{ subadmin_formset.media.css }}
{% endblock Style_sheets %}
{% load widget_tweaks %}

 {% block Content_Area %}
    <!-- Main content -->
    <section class="content">
      <!-- Small boxes (Stat box) -->

     
   	 <div class="box box-default">
        <div class="box-header with-border">
          <h3 class="box-title">{{ Title}}</h3>
          <div class="box-tools pull-right">
            {% comment %}
            <button type="button" class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-minus"></i></button>
            <button type="button" class="btn btn-box-tool" data-widget="remove"><i class="fa fa-remove"></i></button>
            {% endcomment %}
          </div>
        </div>
        {% if messages %}
     {% for message in messages %}
     <div class="alert {{ message.tags }} alert-dismissible" role="alert">
      <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
      {{ message }}
    </div>
    {% endfor %}
    {% endif %}
         <!-- form start -->
         <form role="form" action="" method='post' enctype="multipart/form-data" novalidate ="novalidate">
             {% csrf_token %} 
             {{ form.media }}
        <!-- /.box-header -->

        
        <div class="box-body">
          <div class="row">
            <div class="col-md-6">
              
              <!-- /.form-group -->
                <div class="form-group">
                  <label >
                        Name : 
                  </label>
                 &nbsp;&nbsp; &nbsp;&nbsp;
                   {{staticcontent_qs.userid.Name}}
                </div>
              </div>
              <div class="col-md-6">
              <div class="form-group">
                  <label >
                        Email : 
                  </label>
                 &nbsp;&nbsp; &nbsp;&nbsp;
                   {{staticcontent_qs.email}}
                </div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-6">
                <div class="form-group">
                   <label >
                    Support Category Name: 
                </label>
               &nbsp;&nbsp; &nbsp;&nbsp;
                 {{staticcontent_qs.support_category}}
                </div>
                </div>
                <div class="col-md-6">
               <div class="form-group">
                <label >
                  Subject : 
              </label>
            &nbsp;&nbsp; &nbsp;&nbsp;
              {{staticcontent_qs.subject}}
                </div>
                </div>
                </div>
                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group">
                      <label >
                        Ticket Id : 
                  </label>
                 &nbsp;&nbsp; &nbsp;&nbsp;
                   {{staticcontent_qs.ticket_id}}
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group">
                      <label >
                        Comment : 
                  </label>
                 &nbsp;&nbsp; &nbsp;&nbsp;
                   {{staticcontent_qs.message}}
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group">
                      <label >
                          Attachment : 
                  </label>
                 &nbsp;&nbsp; &nbsp;&nbsp;
                 {% for key,value in img_dict_list.items %}
                 {% if key == "" %}
                    -
                  {% else %}
                  {% if value.file_type == 'jpg' or value.file_type == 'jpeg' or value.file_type == 'png' %}
                      <a href="{{key}}" target="_blank">
                        <img src="{{key}}" width="50px" height="50px">{{value.file_name}}</a><br>
                      {% elif value.file_type == 'mp4' %}
                            <!-- <video width="250" height="100" controls>
                              <source src="{{key}}" type="video/webm">
                              Your browser does not support the video tag.
                            </video> --> 
                            <a href="{{key}}" target="_blank"><img src="{% static 'front_design/img/video.jpeg' %}" width="50px" height="50px">{{value.file_name}}</a>
                      {% elif value.file_type == 'pdf' %}
                          <a href="{{ key }}" target="_blank">{{value.file_name}}</a>
                      {% else %}
                          <a href="{{ key }}">{{value.file_name}}</a>
                          {% endif %}
                          {% endif %}
                   {% endfor %}
                    </div>
                  </div>
                </div>

                {% if staticcontent_qs.support_category == "Recharge Issue" %}
                <div class="row">
                <div class="col-md-6">
                  <div class="form-group">
                    <label >
                      Hash : 
                </label>
               &nbsp;&nbsp; &nbsp;&nbsp;
                 {{staticcontent_qs.phone1}}
                  </div>
                </div>
              </div>
              {% endif %}
                
                <div id="example8_wrapper" class="dataTables_wrapper form-inline dt-bootstrap no-footer">
                  <!-- <img src="" id="main" alt="IMAGE">     -->
                  <table id="example" class="table table-bordered table-striped dataTable no-footer">
                  <thead>
                      <tr>
                        <th>S.No</th>
                        <th>Comment</th>
                        <th>Attachment</th>
                        <th>Created At</th>
                      </tr>
                      </thead>
                      <tbody id="plan_hist_user_table_id">
                        {% if img_dict %}
                        {% for key,value in img_dict.items %}
                        <tr>
                         <td>{{ forloop.counter}}</td>
                         <td>{{ value.comment}}</td>
                         
                         <td>
                          {% if key|slice:8 != "No image" %}
                            {% if value.file_type == 'jpg' or value.file_type == 'jpeg' or value.file_type == 'png' %}
                              <a href="{{key}}" target="_blank">
                                <img src="{{key}}" width="50px" height="50px">{{value.file_name}}</a>
                              {% elif value.file_type == 'webm' %}
                                   <!-- <video width="250" height="100" controls>
                                      <source src="{{key}}" type="video/webm">
                                      Your browser does not support the video tag.
                                    </video> --> 
                                    <a href="{{key}}" target="_blank"><img src="{% static 'front_design/img/video.jpeg' %}" width="50px" height="50px">{{value.file_name}}</a>
                              {% elif value.file_type == 'pdf' %}
                                  <a href="{{ key }}" target="_blank">{{value.file_name}}</a>
                              {% else %}
                                  <a href="{{ key }}">{{value.file_name}}</a>
                                  {% endif %}
                          
                          {% else %}
                              -
                          {% endif %}
                         </td>
                         
                         <td>
                           {{ value.date}}<br>
                           {% if value.user_type == 'admin1' %}
                           <h5><b>Support team</b></h5>
                           {% else %}
                           <h5><b>{{value.user_type}}</b></h5>
                            {% endif %}
                          </td>
                       </tr>
                        {% endfor %}
                        {% else %}
                     <tr><td colspan=5><h5>There are no records yet</h5></td></tr>
                        {% endif %}
                     </tbody>
                </table>
            
                </div>

              {% if staticcontent_qs.read_status != 2 %}
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                          <label >Reply :
                          </label>
                          <span class="text-danger"> * </span>
                          {% if staticcontent_qs.reply != None %}
                          <textarea name="reply" cols="20" rows="5" class="form-control" placeholder="reply" id="id_reply" required>{{staticcontent_qs.reply}}</textarea> 
                          {% else %}             
                          <textarea name="reply" cols="20" rows="5" class="form-control" placeholder="reply" id="id_reply" required></textarea>         
                          {% endif %}     
                          <p class="mt-2" id="error_msg" style="color: red;"></p>
                        </div>
                        </div>
                </div>
                {% endif %}

                {% if staticcontent_qs.read_status != 2 %}
                <div class="row">
                  <div class="col-md-6">
                    <div class="form-group">
                      <label>Attachment</label>
                        <input type="file" name="attachment_file" id="id_file"  onchange="return fileValidation()" multiple />
                      
                    </div>

                  </div>
                </div>
                {% endif %}

                <div class="row">
                    <div class="col-md-6">
                  <div class="form-group">
                    <label >Status  :
                    </label>
                    <input type="hidden" value="{{staticcontent_qs.get_read_status_display}}" id="sts_id">
                    {% if staticcontent_qs.read_status == 2 %}
                    &nbsp;&nbsp; &nbsp;&nbsp;
                     {{staticcontent_qs.get_read_status_display}}
                     
                    {% else %}
                    {% if staticcontent_qs.read_status == 1 or staticcontent_qs.read_status == 4 %}
                    <select name="read_status" class="form-control" placeholder="Status" required="" selected="" id="id_status" aria-required="true">
                                            
                      <option value="{{staticcontent_qs.read_status}}" style="display:none;" selected=selected >{{staticcontent_qs.get_read_status_display}}</option> 
                      <option value="2" {% if staticcontent_qs.read_status == '2' %} selected=selected {% endif %}>Closed</option>  
                      </select>
                      {% else %}
                      <select name="read_status" class="form-control" placeholder="Status" required="" selected="" id="id_status" aria-required="true">
                                            
                        <option value="{{staticcontent_qs.read_status}}" style="display:none;" selected=selected >{{staticcontent_qs.get_read_status_display}}</option> 
                        <option value="1" {% if staticcontent_qs.read_status == '1' %} selected=selected {% endif %}>Replied</option> 
                      </select>
                      {% endif %}
                      {% endif %}
                  </div>
                  </div>
                  
                  </div>
                  <div class="box-footer">
                    <button type="submit" class="btn btn-primary" onclick="submit_validation()">Submit</button>
                         &nbsp;&nbsp;
                         <a href="/trademaster/User_request_list/" class="btn btn-primary">Back</a>
                 </div>
                  </form>

            </div>
            
          </div>
       
    </section>

    </script>

<script>
function submit_validation() {
  var rply = $("#id_reply").val();
  if (rply == "") {
    document.getElementById("error_msg").innerHTML = "This field is required"
  } else {
    document.getElementById("error_msg").innerHTML = ""
  }
}
</script>

<script>
$(function() {
  var sts_id = $("#sts_id").val();
  if (sts_id == "Closed") {
    $("button").hide();
  } else {
    $("button").show();
  }
});
</script>


<script>

  function validate_msg(type,message){
      
    if (type =='success'){
      var success_text =  message;
      
      Lobibox.notify('success', {
      title:'Success',
      continueDelayOnInactiveTab: false,
      pauseDelayOnHover: true,
      sound: false,
      position: 'right top',
      msg: success_text
      });
  
    }
  
    if (type =='error'){
      var error_text = message
      Lobibox.notify('error', {
      title:'Error',
      continueDelayOnInactiveTab: false,
      pauseDelayOnHover: true,
      sound: false,
      position: 'right top',
      msg: error_text
      });
  
    }
  
  }
  
  </script>

<script>
  function fileValidation(){
    var fileInput = document.getElementById('id_file');
    var filePath = fileInput.value;
    var file = fileInput.files;
     if(file.length==0){
         alert("No File Chosen");
         return false;
     }

     var fileSize = Math.round((file[0].size / 1024));
  
     if (fileSize <= 5*1024) {
         var allowedExtensions = /(\.jpg|\.jpeg|\.png|\.webm|\.pdf)$/i;
          if(!allowedExtensions.exec(filePath)){
              validate_msg('error', "Please upload file having extensions .jpeg/.jpg/.png/.pdf/.webm only.")
              fileInput.value = '';
              return false;
          }else{
            //Image preview
            if (fileInput.files && fileInput.files[0]) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('imagePreview').innerHTML = '<img src="'+e.target.result+'"/>';
                };
                reader.readAsDataURL(fileInput.files[0]);
                validate_msg('success', "File uploaded successfuly")
            }
        }
     } else {
           validate_msg('error', "Error! File too large")
     }

    
}


</script>




 {% endblock Content_Area %}

 {% block Java_Scripts %}

 {% endblock %}


